{"version":3,"sources":["../src/config/envSchema.ts","../src/config/parseConfig.ts","../src/config/loadConfig.ts","../src/schema/users.ts","../src/client.ts"],"names":["dotenv"],"mappings":";;;;;;;;AAEO,IAAM,WAAA,GAAc,EAAE,MAAA,CAAO;AAAA,EAClC,YAAA,EAAc,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA;AAC3B,CAAC;;;ACAM,SAAS,aAAA,CAAc,QAAiB,MAAA,EAA+C;AAC5F,EAAA,MAAM,MAAA,GAAS,WAAA,CAAY,SAAA,CAAU,MAAM,CAAA;AAE3C,EAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,IAAA,MAAM,IAAI,KAAA,CAAM,MAAA,CAAO,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,EACtC;AAEA,EAAA,OAAO,MAAA,CAAO,IAAA;AAChB;AARgB,MAAA,CAAA,aAAA,EAAA,eAAA,CAAA;;;ACChB,IAAI,YAAA;AAEG,SAAS,YAAA,GAAyB;AACvC,EAAA,IAAI,YAAA,EAAc;AAChB,IAAA,OAAO,YAAA;AAAA,EACT;AAEA,EAAAA,MAAA,CAAO,EAAE,KAAA,EAAO,IAAA,EAAM,CAAA;AACtB,EAAA,YAAA,GAAe,aAAA;AAAA,IACb,OAAA,CAAQ,GAAA;AAAA,IACR,CAAC,KAAA,KAAU,CAAA,gCAAA,EAAmC,KAAA,CAAM,OAAO,CAAA;AAAA,GAC7D;AAEA,EAAA,OAAO,YAAA;AACT;AAZgB,MAAA,CAAA,YAAA,EAAA,cAAA,CAAA;AAcT,SAAS,mBAAA,GAAsB;AACpC,EAAA,YAAA,GAAe,MAAA;AACjB;AAFgB,MAAA,CAAA,mBAAA,EAAA,qBAAA,CAAA;ACnBT,IAAM,KAAA,GAAQ,QAAQ,OAAA,EAAS;AAAA,EACpC,KAAA,EAAO,OAAA,CAAQ,OAAA,EAAS,EAAE,MAAA,EAAQ,KAAK,CAAA,CAAE,OAAA,EAAQ,CAAE,MAAA,EAAO;AAAA,EAC1D,IAAI,IAAA,CAAK,IAAI,CAAA,CAAE,UAAA,GAAa,aAAA;AAC9B,CAAC;;;ACGM,IAAM,YAAA,GAAqB;AAAA,EAChC,KAAA,EAAO,kBAAA;AAAA,EACP,EAAA,EAAI;AACN;AAEO,SAAS,SAAS,MAAA,EAA6B;AACpD,EAAA,MAAM,cAAA,GAAiB,MAAA,GACnB,aAAA,CAAc,MAAA,EAAQ,CAAC,KAAA,KAAU,CAAA,gCAAA,EAAmC,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA,GACnF,YAAA,EAAa;AACjB,EAAA,MAAM,GAAA,GAAM,IAAA,CAAK,cAAA,CAAe,YAAY,CAAA;AAE5C,EAAA,OAAO,QAAQ,GAAA,EAAK,EAAE,QAAQ,EAAE,KAAA,IAAS,CAAA;AAC3C;AAPgB,MAAA,CAAA,QAAA,EAAA,UAAA,CAAA;AAShB,eAAsB,cAAA,CAAe,EAAA,GAAe,QAAA,EAAS,EAAkB;AAC7E,EAAA,MAAM,CAAC,IAAI,CAAA,GAAI,MAAM,EAAA,CAAG,MAAA,EAAO,CAAE,IAAA,CAAK,KAAK,CAAA,CAAE,KAAA,CAAM,CAAC,CAAA;AAEpD,EAAA,OAAO,IAAA,IAAQ,YAAA;AACjB;AAJsB,MAAA,CAAA,cAAA,EAAA,gBAAA,CAAA","file":"index.js","sourcesContent":["import { z } from 'zod'\n\nexport const dbEnvSchema = z.object({\n  DATABASE_URL: z.string().url()\n})\n\nexport type DbConfig = z.infer<typeof dbEnvSchema>\n","import { ZodError } from 'zod'\n\nimport { dbEnvSchema, type DbConfig } from './envSchema'\n\nexport function parseDbConfig(config: unknown, format: (error: ZodError) => string): DbConfig {\n  const result = dbEnvSchema.safeParse(config)\n\n  if (!result.success) {\n    throw new Error(format(result.error))\n  }\n\n  return result.data\n}\n","import { config as dotenv } from 'dotenv'\n\nimport { type DbConfig } from './envSchema'\nimport { parseDbConfig } from './parseConfig'\n\nlet cachedConfig: DbConfig | undefined\n\nexport function loadDbConfig(): DbConfig {\n  if (cachedConfig) {\n    return cachedConfig\n  }\n\n  dotenv({ quiet: true })\n  cachedConfig = parseDbConfig(\n    process.env,\n    (error) => `Invalid database configuration: ${error.message}`\n  )\n\n  return cachedConfig\n}\n\nexport function resetCachedDbConfig() {\n  cachedConfig = undefined\n}\n","import { pgTable, uuid, varchar } from 'drizzle-orm/pg-core'\n\nexport const users = pgTable('users', {\n  email: varchar('email', { length: 255 }).notNull().unique(),\n  id: uuid('id').primaryKey().defaultRandom()\n})\n\nexport type User = typeof users.$inferSelect\n","import { neon } from '@neondatabase/serverless'\nimport { drizzle } from 'drizzle-orm/neon-http'\n\nimport { loadDbConfig, parseDbConfig, type DbConfig } from './config'\nimport { users, type User } from './schema'\n\nexport type DbClient = ReturnType<typeof drizzle>\n\nexport const fallbackUser: User = {\n  email: 'demo@power.coach',\n  id: '00000000-0000-4000-8000-000000000000'\n}\n\nexport function createDb(config?: DbConfig): DbClient {\n  const resolvedConfig = config\n    ? parseDbConfig(config, (error) => `Invalid database configuration: ${error.message}`)\n    : loadDbConfig()\n  const sql = neon(resolvedConfig.DATABASE_URL)\n\n  return drizzle(sql, { schema: { users } })\n}\n\nexport async function fetchFirstUser(db: DbClient = createDb()): Promise<User> {\n  const [user] = await db.select().from(users).limit(1)\n\n  return user ?? fallbackUser\n}\n"]}